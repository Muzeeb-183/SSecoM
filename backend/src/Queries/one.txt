-- -- Create Users table for SSecoM Student Ecommerce Platform
 CREATE TABLE Users (
     id NVARCHAR(50) PRIMARY KEY,           -- Google ID from 'sub' claim
     email NVARCHAR(255) UNIQUE NOT NULL,  -- User email
     name NVARCHAR(255) NOT NULL,          -- Full name
     picture NVARCHAR(500),                -- Profile picture URL
     createdAt DATETIME2 DEFAULT GETDATE(),-- Account creation timestamp
     lastLoginAt DATETIME2 DEFAULT GETDATE(),-- Last login timestamp
     isActive BIT DEFAULT 1                 -- Account status
 );

-- -- Verify table creation
 SELECT * FROM Users;



-- Categories table
CREATE TABLE Categories (
    id NVARCHAR(50) PRIMARY KEY DEFAULT NEWID(),
    name NVARCHAR(255) NOT NULL,
    description NVARCHAR(500),
    slug NVARCHAR(255) UNIQUE,
    status NVARCHAR(20) DEFAULT 'active',
    createdAt DATETIME DEFAULT GETDATE(),
    updatedAt DATETIME DEFAULT GETDATE()
);

-- Products table  
CREATE TABLE Products (
    id NVARCHAR(50) PRIMARY KEY DEFAULT NEWID(),
    categoryId NVARCHAR(50) NOT NULL,
    name NVARCHAR(255) NOT NULL,
    description NVARCHAR(MAX),
    price DECIMAL(10, 2) NOT NULL,
    originalPrice DECIMAL(10, 2),
    affiliateLink NVARCHAR(500) NOT NULL,
    imageUrl NVARCHAR(500),
    tags NVARCHAR(500),
    status NVARCHAR(20) DEFAULT 'active',
    createdAt DATETIME DEFAULT GETDATE(),
    updatedAt DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (categoryId) REFERENCES Categories(id)
);


-- Run this in your SQL Server Management Studio or database client:
ALTER TABLE Products 
ALTER COLUMN affiliateLink NVARCHAR(MAX);

ALTER TABLE Products 
ALTER COLUMN imageUrl NVARCHAR(MAX);

-- Optional: Also increase tags if needed
ALTER TABLE Products 
ALTER COLUMN tags NVARCHAR(MAX);


for buttons and  images(3)

-- Add new columns for enhanced product features
ALTER TABLE Products 
ADD images NVARCHAR(MAX),
    buttons NVARCHAR(MAX);



for imagekit images adding 

-- Add column to store ImageKit file IDs for deletion capability
ALTER TABLE Products 
ADD imageFileIds NVARCHAR(MAX);  -- JSON array of ImageKit file IDs

-- Verify the column was added
SELECT COLUMN_NAME, DATA_TYPE, IS_NULLABLE 
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_NAME = 'Products' AND COLUMN_NAME = 'imageFileIds';



-- Create CartItems table for user-specific cart storage
CREATE TABLE CartItems (
    id NVARCHAR(50) PRIMARY KEY DEFAULT NEWID(),
    userId NVARCHAR(50) NOT NULL,
    productId NVARCHAR(50) NOT NULL,
    quantity INT NOT NULL DEFAULT 1,
    addedAt DATETIME2 DEFAULT GETDATE(),
    updatedAt DATETIME2 DEFAULT GETDATE(),
    
    -- Foreign key constraints
    FOREIGN KEY (userId) REFERENCES Users(id) ON DELETE CASCADE,
    FOREIGN KEY (productId) REFERENCES Products(id) ON DELETE CASCADE,
    
    -- Unique constraint to prevent duplicate items per user
    UNIQUE(userId, productId)
);

-- Create indexes for better performance
CREATE INDEX IX_CartItems_UserId ON CartItems(userId);
CREATE INDEX IX_CartItems_ProductId ON CartItems(productId);
CREATE INDEX IX_CartItems_AddedAt ON CartItems(addedAt DESC);

-- Verify table creation
SELECT * FROM CartItems;


for adding images to categories

-- Add imageUrl column to existing Categories table
ALTER TABLE Categories 
ADD imageUrl NVARCHAR(500);

-- Update the column to allow NULL initially for existing categories
-- Existing categories will use emoji fallbacks until images are added
